<app-nav></app-nav>

<main class="bg-background min-h-screen pt-8 pb-16 scroll-smooth">

  <!-- Contenedor principal -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-16">

    <!-- üîç Buscador + Filtros -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in-up">

      <!-- Panel de b√∫squeda -->
      <div class="lg:col-span-2 bg-card p-6 sm:p-8 rounded-2xl shadow-md border border-border">
        <h2 class="text-2xl font-bold text-foreground mb-4">Explora lo mejor del Huila</h2>

        <div class="space-y-4">
          <!-- Campo de b√∫squeda -->
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="busqueda"
              (keyup.enter)="buscarProductos()"
              placeholder="Buscar por nombre o artesano..."
              class="w-full p-3 pl-10 rounded-lg bg-input border border-border focus:ring-2 focus:ring-primary/40 focus:border-primary text-foreground placeholder:text-muted-foreground transition"
            />
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-3.5 text-muted-foreground"></i>
          </div>

          <!-- Categor√≠as -->
          <select
            [(ngModel)]="categoriaSeleccionada"
            class="w-full p-3 rounded-lg bg-input border border-border text-foreground focus:ring-2 focus:ring-primary/40 focus:border-primary transition"
          >
            <option value="">Categor√≠a: Todas</option>
            <option value="Tejidos">Tejidos</option>
            <option value="Cer√°mica">Cer√°mica</option>
            <option value="Guadua">Guadua</option>
            <option value="Caf√©">Caf√©</option>
            <option value="Joyer√≠a">Joyer√≠a</option>
            <option value="Ropa deportiva">Ropa deportiva</option>
          </select>

          <!-- Botones -->
          <div class="flex flex-wrap gap-3">
            <button (click)="buscarProductos()" class="btn btn-primary px-6 py-2.5 rounded-lg text-white font-semibold">
              Buscar
            </button>
            <button (click)="limpiarFiltros()" class="btn btn-outline px-6 py-2.5 rounded-lg font-semibold">
              Limpiar
            </button>
          </div>

          <!-- Resultado -->
          <p class="text-sm text-muted-foreground mt-2">
            Mostrando <span class="font-medium text-foreground">{{ productos.length }}</span> de <span class="font-medium text-foreground">{{ total }}</span> productos.
          </p>
        </div>
      </div>

      <!-- Banner lateral -->
      <div class="bg-gradient-to-br from-secondary to-white p-6 rounded-2xl shadow-md flex flex-col justify-between animate-fade-in-up">
        <img
          src="assets/landing-resources/resource3.png"
          alt="Artesan√≠as del Huila"
          class="rounded-xl mb-4 w-full h-44 object-cover shadow-sm"
        />
        <h3 class="text-xl font-bold text-secondary-foreground mb-2">Hecho a mano con alma huilense</h3>
        <p class="text-muted-foreground mb-6 leading-relaxed">
          Compra directo a artesanos locales y descubre la historia detr√°s de cada pieza √∫nica.
        </p>
        <a href="#" class="btn btn-primary w-full py-3 text-center font-semibold rounded-lg hover:scale-[1.02] transition">
          Ver colecciones
        </a>
      </div>
    </div>

    <!-- üõçÔ∏è Productos -->
    <section class="animate-fade-in-up">
      <h2 class="text-3xl font-bold mb-8 section-title text-foreground text-center md:text-left">
        {{ categoriaSeleccionada || busqueda ? 'Resultados de b√∫squeda' : 'Productos destacados' }}
      </h2>

      <!-- Loading -->
      <div *ngIf="cargando" class="flex flex-col items-center justify-center py-12">
        <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-muted-foreground">Cargando productos...</p>
      </div>

      <!-- Sin resultados -->
      <div *ngIf="!cargando && productos.length === 0" class="text-center py-12">
        <p class="text-lg text-muted-foreground mb-4">No se encontraron productos.</p>
        <button (click)="limpiarFiltros()" class="btn btn-primary px-6 py-2.5 rounded-lg font-semibold">
          Ver todos los productos
        </button>
      </div>

      <!-- Grid de productos -->
      <div *ngIf="!cargando && productos.length > 0"
           class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div
          *ngFor="let producto of productos"
          class="bg-card rounded-2xl shadow-sm hover:shadow-md border border-border overflow-hidden cursor-pointer transition hover:-translate-y-1"
          (click)="verDetalle(producto.id_producto)"
        >
          <img
            [src]="producto.imagenes?.length ? producto.imagenes[0] : 'assets/landing-resources/product1.png'"
            [alt]="producto.nombre"
            class="w-full h-48 object-cover"
          />
          <div class="p-4 flex flex-col justify-between">
            <h3 class="text-lg font-semibold text-foreground mb-1">{{ producto.nombre }}</h3>
            <p class="text-sm text-muted-foreground line-clamp-2 mb-3">{{ producto.descripcion }}</p>
            <div class="flex items-center justify-between">
              <span class="text-primary font-bold">${{ producto.precio }}</span>
              <button
                (click)="verDetalle(producto.id_producto); $event.stopPropagation()"
                class="text-sm text-primary hover:underline font-medium"
              >
                Ver detalle
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Paginaci√≥n -->
      <div *ngIf="!cargando && productos.length > 0 && totalPaginas > 1"
           class="flex flex-wrap justify-center items-center gap-2 mt-12">
        <button
          (click)="cambiarPagina(paginaActual - 1)"
          [disabled]="paginaActual === 1"
          class="btn btn-outline btn-sm"
        >
          Anterior
        </button>

        <div class="flex flex-wrap gap-1">
          <button
            *ngFor="let pagina of paginasArray"
            (click)="cambiarPagina(pagina)"
            class="btn btn-sm min-w-[40px] rounded-lg"
            [ngClass]="{
              'bg-primary text-white': pagina === paginaActual,
              'btn-outline': pagina !== paginaActual
            }"
          >
            {{ pagina }}
          </button>
        </div>

        <button
          (click)="cambiarPagina(paginaActual + 1)"
          [disabled]="paginaActual === totalPaginas"
          class="btn btn-outline btn-sm"
        >
          Siguiente
        </button>
      </div>
    </section>
  </section>
</main>
