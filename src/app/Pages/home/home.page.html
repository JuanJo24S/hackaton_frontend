<app-nav></app-nav>
<main class="bg-background pt-8 pb-12 scroll-smooth min-h-screen">

  <!-- Contenedor principal -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Buscador y filtros -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12 animate-fade-in-up">

      <!-- Filtros -->
      <div class="lg:col-span-2 bg-card p-6 rounded-2xl shadow-soft border border-border">
        <h2 class="heading-md mb-4 text-foreground">Explora lo mejor del Huila</h2>

        <div class="flex flex-col gap-4">
          <!-- Campo de búsqueda -->
          <input
            type="text"
            [(ngModel)]="busqueda"
            (keyup.enter)="buscarProductos()"
            placeholder="Buscar por nombre de producto o artesano"
            class="p-3 rounded-lg bg-input border border-border focus-ring text-foreground"
          />

          <!-- Categorías -->
          <div class="flex flex-col sm:flex-row gap-4">
            <select
              [(ngModel)]="categoriaSeleccionada"
              class="p-3 rounded-lg bg-input border border-border text-foreground flex-1 focus-ring"
            >
              <option value="">Categoría: Todas</option>
              <option value="Tejidos">Tejidos</option>
              <option value="Cerámica">Cerámica</option>
              <option value="Guadua">Guadua</option>
              <option value="Café">Café</option>
              <option value="Joyería">Joyería</option>
              <option value="Ropa deportiva">Ropa deportiva</option>
            </select>
          </div>

          <!-- Botones -->
          <div class="flex flex-wrap gap-3">
            <button (click)="buscarProductos()" class="btn btn-primary">Buscar</button>
            <button (click)="limpiarFiltros()" class="btn btn-outline">Limpiar filtros</button>
          </div>

          <p class="text-sm text-muted-foreground mt-2">
            Mostrando {{ productos.length }} de {{ total }} productos
          </p>
        </div>
      </div>

      <!-- Banner lateral -->
      <div class="bg-secondary p-6 rounded-2xl shadow-soft flex flex-col justify-between animate-scale-in">
        <div>
          <img
            src="assets/landing-resources/resource3.png"
            alt="Artesanías del Huila"
            class="rounded-xl mb-4 w-full h-44 object-cover"
          />
          <h3 class="heading-md mb-2 text-secondary-foreground">Hecho a mano con alma huilense</h3>
          <p class="text-muted-foreground mb-4">
            Compra directo a artesanos locales y conoce la historia detrás de cada pieza.
          </p>
        </div>
        <a href="#" class="btn btn-primary w-full">Ver colecciones</a>
      </div>
    </div>

    <!-- Productos -->
    <section class="animate-fade-in-up">
      <h2 class="heading-lg mb-8 section-title">
        {{ categoriaSeleccionada || busqueda ? 'Resultados de búsqueda' : 'Productos destacados' }}
      </h2>

      <!-- Loading -->
      <div *ngIf="cargando" class="text-center py-12">
        <div class="inline-block w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
        <p class="text-muted-foreground mt-4">Cargando productos...</p>
      </div>

      <!-- Sin resultados -->
      <div *ngIf="!cargando && productos.length === 0" class="text-center py-12">
        <p class="text-muted-foreground text-lg">No se encontraron productos</p>
        <button (click)="limpiarFiltros()" class="btn btn-primary mt-4">Ver todos los productos</button>
      </div>

      <!-- Grid de productos -->
      <div *ngIf="!cargando && productos.length > 0" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div *ngFor="let producto of productos" class="card card-product hover-lift cursor-pointer" (click)="verDetalle(producto.id_producto)">
          <img
            [src]="producto.imagenes && producto.imagenes.length > 0 ? producto.imagenes[0] : 'assets/landing-resources/product1.png'"
            [alt]="producto.nombre"
            class="w-full h-48 object-cover rounded-t-xl"
          >
          <h3 class="text-lg font-semibold text-foreground mt-3">{{ producto.nombre }}</h3>
          <p class="text-sm text-muted-foreground mb-2 line-clamp-2">{{ producto.descripcion }}</p>
          <div class="flex items-center gap-2 mb-3">
            <span class="badge badge-primary text-xs">{{ producto.categoria }}</span>
            <span *ngIf="producto.stock > 0" class="text-xs text-green-600">Stock: {{ producto.stock }}</span>
            <span *ngIf="producto.stock === 0" class="text-xs text-red-600">Agotado</span>
          </div>
          <div class="flex justify-between items-center">
            <p class="price">${{ producto.precio }}</p>
            <button class="btn btn-secondary btn-sm" (click)="verDetalle(producto.id_producto); $event.stopPropagation()">
              Ver detalle
            </button>
          </div>
        </div>
      </div>

      <!-- Paginación -->
      <div *ngIf="!cargando && productos.length > 0 && totalPaginas > 1" class="flex justify-center items-center gap-2 mt-12">
        <button
          (click)="cambiarPagina(paginaActual - 1)"
          [disabled]="paginaActual === 1"
          class="btn btn-outline btn-sm"
          [class.opacity-50]="paginaActual === 1"
        >
          Anterior
        </button>

        <div class="flex gap-1">
          <button
            *ngFor="let pagina of paginasArray"
            (click)="cambiarPagina(pagina)"
            [class.btn-primary]="pagina === paginaActual"
            [class.btn-outline]="pagina !== paginaActual"
            class="btn btn-sm min-w-[40px]"
          >
            {{ pagina }}
          </button>
        </div>

        <button
          (click)="cambiarPagina(paginaActual + 1)"
          [disabled]="paginaActual === totalPaginas"
          class="btn btn-outline btn-sm"
          [class.opacity-50]="paginaActual === totalPaginas"
        >
          Siguiente
        </button>
      </div>
    </section>
  </section>
</main>
